{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport { FlatList, TextInput } from 'react-native-gesture-handler';\nimport Icon from \"@expo/vector-icons/FontAwesome5\";\nimport { UIHeader } from \"../../components\";\nimport { colors } from \"../../constants\";\nimport MessengerItem from \"./MessengerItem\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { firebaseDatabase, firebaseDatabaseRef, firebaseSet, onValue } from \"../../firebase/firebase\";\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar Messenger = function Messenger(props) {\n  var safeAreaInsets = useSafeAreaInsets();\n  var _props$route$params$u = props.route.params.user,\n      url = _props$route$params$u.url,\n      name = _props$route$params$u.name;\n  var navigation = props.navigation;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      typedText = _useState2[0],\n      setTypedText = _useState2[1];\n\n  var _useState3 = useState([{}]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      chatHistory = _useState4[0],\n      setChatHistory = _useState4[1];\n\n  useEffect(function () {\n    onValue(firebaseDatabaseRef(firebaseDatabase, 'chats'), function _callee(snapshot) {\n      var snapshotObject, stringUser, myUserId, updatedChatHistory, i, user1_c, user1_n;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!snapshot.exists()) {\n                _context.next = 11;\n                break;\n              }\n\n              snapshotObject = snapshot.val();\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('user'));\n\n            case 4:\n              stringUser = _context.sent;\n              myUserId = JSON.parse(stringUser).userId;\n              updatedChatHistory = Object.keys(snapshotObject).filter(function (item) {\n                return item.includes(myUserId) && item.includes(props.route.params.user.userId);\n              }).map(function (eachKey) {\n                return _objectSpread(_objectSpread({}, snapshotObject[eachKey]), {}, {\n                  isSender: eachKey.split('-')[0] == myUserId,\n                  userId1: eachKey.split('-')[0],\n                  userId2: eachKey.split('-')[1]\n                });\n              }).sort(function (item1, item2) {\n                return item1.timestamp - item2.timestamp;\n              });\n              debugger;\n\n              for (i = 0; i < updatedChatHistory.length; i++) {\n                if (i < updatedChatHistory.length - 1) {\n                  user1_c = updatedChatHistory[i].userId1;\n                  user1_n = updatedChatHistory[i + 1].userId1;\n                  console.log(user1_c + \"-\" + user1_n);\n                }\n              }\n\n              setChatHistory(updatedChatHistory);\n              debugger;\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n  }, []);\n  return _jsxs(View, {\n    style: {\n      flexDirection: 'column',\n      flex: 1\n    },\n    children: [_jsx(View, {\n      style: {\n        height: safeAreaInsets.top\n      }\n    }), _jsx(UIHeader, {\n      title: name,\n      lefIconName: 'arrow-left',\n      rightIconName: 'ellipsis-v',\n      onPressLeftIcon: function onPressLeftIcon() {\n        navigation.goBack();\n      },\n      onPressRightIcon: function onPressRightIcon() {\n        return alert('right icon');\n      }\n    }), _jsx(FlatList, {\n      style: {\n        flex: 1\n      },\n      keyExtractor: function keyExtractor(item) {\n        return item.messenger;\n      },\n      data: chatHistory,\n      renderItem: function renderItem(_ref) {\n        var item = _ref.item,\n            index = _ref.index;\n        return _jsx(MessengerItem, {\n          item: item,\n          onPress: function onPress() {\n            return alert(\"234\");\n          }\n        }, \"\" + item.timestamp);\n      }\n    }), _jsxs(View, {\n      style: {\n        height: 50,\n        position: 'absolute',\n        bottom: 0,\n        left: 0,\n        right: 0,\n        borderTopWidth: 1,\n        borderTopColor: '#ccc',\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        alignItems: 'center'\n      },\n      children: [_jsx(TextInput, {\n        value: typedText,\n        onChangeText: function onChangeText(text) {\n          setTypedText(text);\n        },\n        placeholder: \"Enter your message here\",\n        placeholderTextColor: colors.placeholder,\n        style: {\n          height: 50,\n          paddingStart: 10,\n          color: 'black',\n          flex: 1\n        }\n      }), _jsx(TouchableOpacity, {\n        onPress: function _callee2() {\n          var stringUser, myUserId, myFriendUserId, newMessengerObject;\n          return _regeneratorRuntime.async(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  if (!(typedText.trim().length == 0)) {\n                    _context2.next = 2;\n                    break;\n                  }\n\n                  return _context2.abrupt(\"return\");\n\n                case 2:\n                  _context2.next = 4;\n                  return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"user\"));\n\n                case 4:\n                  stringUser = _context2.sent;\n                  myUserId = JSON.parse(stringUser).userId;\n                  myFriendUserId = props.route.params.user.userId;\n                  newMessengerObject = {\n                    url: 'https://randomuser.me/api/portraits/men/50.jpg',\n                    showUrl: false,\n                    messenger: typedText,\n                    timestamp: new Date().getTime()\n                  };\n                  Keyboard.dismiss();\n                  firebaseSet(firebaseDatabaseRef(firebaseDatabase, \"chats/\" + myUserId + \"-\" + myFriendUserId + \"-\" + newMessengerObject.timestamp), newMessengerObject).then(function () {\n                    setTypedText('');\n                  });\n\n                case 10:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        },\n        children: _jsx(Icon, {\n          name: \"paper-plane\",\n          size: 20,\n          color: colors.primary,\n          style: {\n            padding: 10\n          }\n        })\n      })]\n    })]\n  });\n};\n\nexport default Messenger;","map":{"version":3,"names":["React","useEffect","useState","FlatList","TextInput","Icon","UIHeader","colors","MessengerItem","AsyncStorage","firebaseDatabase","firebaseDatabaseRef","firebaseSet","onValue","useSafeAreaInsets","Messenger","props","safeAreaInsets","route","params","user","url","name","navigation","typedText","setTypedText","chatHistory","setChatHistory","snapshot","exists","snapshotObject","val","getItem","stringUser","myUserId","JSON","parse","userId","updatedChatHistory","Object","keys","filter","item","includes","map","eachKey","isSender","split","userId1","userId2","sort","item1","item2","timestamp","i","length","user1_c","user1_n","console","log","flexDirection","flex","height","top","goBack","alert","messenger","index","position","bottom","left","right","borderTopWidth","borderTopColor","justifyContent","alignItems","text","placeholder","paddingStart","color","trim","myFriendUserId","newMessengerObject","showUrl","Date","getTime","Keyboard","dismiss","then","primary","padding"],"sources":["D:/React/react-native-project/training-app/screens/Messenger/Messeger.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n    Text,\n    View,\n    Image,\n    Dimensions,\n    TouchableOpacity,\n    Keyboard\n} from \"react-native\";\nimport { FlatList, TextInput } from 'react-native-gesture-handler';\nimport Icon from 'react-native-vector-icons/FontAwesome5';\nimport { SafeAreaView } from 'react-navigation';\nimport { UIHeader } from '../../components';\nimport { colors, fontSizes } from '../../constants';\nimport MessengerItem from './MessengerItem';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport {\n    auth,\n    firebaseDatabase,\n    onAuthStateChanged,\n    firebaseDatabaseRef,\n    firebaseSet,\n    onValue\n} from '../../firebase/firebase'\n\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\n\nconst Messenger = (props: any) => {\n    const safeAreaInsets = useSafeAreaInsets();\n    const { url, name } = props.route.params.user;\n    const { navigation } = props;\n    const [typedText, setTypedText] = useState('');\n    const [chatHistory, setChatHistory] = useState([\n        {\n            // url: 'https://randomuser.me/api/portraits/men/70.jpg',\n            // showUrl: true,\n            // isSender: true,\n            // messenger: \"Hello\",\n            // timestamp: 1641654238000,\n        }\n    ]);\n\n    useEffect(() => {\n        // alert(JSON.stringify(safeAreaInsets));\n        onValue(firebaseDatabaseRef(firebaseDatabase, 'chats'), async (snapshot) => {\n            // debugger\n            if (snapshot.exists()) {\n                let snapshotObject = snapshot.val();\n                let stringUser = await AsyncStorage.getItem('user');\n                let myUserId = JSON.parse(stringUser).userId;\n                // debugger\n                let updatedChatHistory = Object.keys(snapshotObject).filter(item => item.includes(myUserId) && item.includes(props.route.params.user.userId))\n                    .map(eachKey => {\n                        // debugger\n                        return {\n                            ...snapshotObject[eachKey],\n                            isSender: eachKey.split('-')[0] == myUserId,\n                            userId1: eachKey.split('-')[0],\n                            userId2: eachKey.split('-')[1]\n                        }\n                    }).sort((item1, item2) => item1.timestamp - item2.timestamp);\n                debugger\n                for (let i = 0; i < updatedChatHistory.length; i++) {\n                    if (i < updatedChatHistory.length - 1) {\n                        let user1_c = updatedChatHistory[i].userId1;\n                        let user1_n = updatedChatHistory[i + 1].userId1;\n\n                        console.log(`${user1_c}-${user1_n}`);\n                    }\n\n                }\n                // console.log(updatedChatHistory);\n                setChatHistory(updatedChatHistory);\n                debugger\n            }\n        })\n    }, [])\n\n    return (\n        <View\n            style={{\n                flexDirection: 'column',\n                flex: 1\n            }}\n        >\n            <View style={{ height: safeAreaInsets.top }} />\n            <UIHeader\n                title={name}\n                lefIconName={'arrow-left'}\n                rightIconName={'ellipsis-v'}\n                onPressLeftIcon={() => {\n                    navigation.goBack();\n                }}\n                onPressRightIcon={() => {\n                    return alert('right icon');\n                }}\n            />\n            <FlatList\n                style={{\n                    flex: 1\n                }}\n                keyExtractor={(item,) => item.messenger}\n                data={chatHistory}\n                renderItem={({ item, index }) =>\n                    <MessengerItem\n                        key={`${item.timestamp}`}\n                        item={item}\n                        onPress={() => alert(\"234\")}\n                    />}\n            />\n            <View style={{\n                height: 50,\n                position: 'absolute',\n                bottom: 0,\n                left: 0,\n                right: 0,\n                borderTopWidth: 1,\n                borderTopColor: '#ccc',\n                flexDirection: 'row',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n            }}>\n                <TextInput\n                    value={typedText}\n                    onChangeText={(text) => {\n                        setTypedText(text)\n                    }}\n                    placeholder='Enter your message here'\n                    placeholderTextColor={colors.placeholder}\n                    style={{\n                        height: 50,\n                        paddingStart: 10,\n                        color: 'black',\n                        flex: 1\n                    }}\n                />\n                <TouchableOpacity\n                    onPress={async () => {\n                        if (typedText.trim().length == 0) {\n                            return\n                        }\n\n                        let stringUser = await AsyncStorage.getItem(\"user\")\n                        let myUserId = JSON.parse(stringUser).userId\n                        let myFriendUserId = props.route.params.user.userId\n                        //save to Firebase DB\n                        let newMessengerObject = {\n                            //fake\n                            url: 'https://randomuser.me/api/portraits/men/50.jpg',\n                            showUrl: false,\n                            messenger: typedText,\n                            timestamp: (new Date()).getTime(),\n                        }\n                        Keyboard.dismiss()\n                        firebaseSet(firebaseDatabaseRef(\n                            firebaseDatabase,\n                            `chats/${myUserId}-${myFriendUserId}-${newMessengerObject.timestamp}`\n                        ), newMessengerObject).then(() => {\n                            setTypedText('')\n                        })\n                    }}\n                >\n                    <Icon name='paper-plane' size={20} color={colors.primary} style={{\n                        padding: 10\n                    }} />\n                </TouchableOpacity>\n            </View>\n        </View>\n    )\n}\n\nexport default Messenger"],"mappings":"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"},"metadata":{},"sourceType":"module"}